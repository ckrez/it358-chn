<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="canonical" href="https://ckrez.github.io/it358-chn/configuring_cif/">
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Setting Up Logging to CIFv3 - IT358 Honeypot Lab</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Setting Up Logging to CIFv3";
    var mkdocs_page_input_path = "configuring_cif.md";
    var mkdocs_page_url = "/it358-chn/configuring_cif/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> IT358 Honeypot Lab</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">Using SSH</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../preparing/">Prepare your hosts</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../build_server/">Building CHN Server</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../first_honeypot/">Deploying Your First Honeypot</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../configuring_logging/">Setting Up Logging for Honeypot Data</a>
                    </li>
                </ul>
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Setting Up Logging to CIFv3</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#configuring-logging-to-cifv3">Configuring logging to CIFv3</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#updating-chn-server-to-log-to-cifv3">Updating CHN Server to log to CIFv3</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#start-the-hpfeeds-cif-container">Start the hpfeeds-cif container</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#test-your-cif-install">Test your CIF install</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#installing-cif-tools">Installing CIF Tools</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#querying-cif">Querying CIF</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#bonus">Bonus</a>
    </li>
    </ul>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">IT358 Honeypot Lab</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Setting Up Logging to CIFv3</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="set-up-logging-to-cifv3">Set Up Logging to CIFv3</h1>
<h2 id="configuring-logging-to-cifv3">Configuring logging to CIFv3</h2>
<p>If you do not already have an SSH session established with your workshop-chn-server, SSH into your CHN Server instance.</p>
<p>On Mac/Linux:</p>
<pre><code class="bash">ssh -l ubuntu -p 4222 ${GROUP CHN SERVER}
</code></pre>

<p>On Windows:</p>
<pre><code class="bash">ssh -l ubuntu -p 4222 ${GROUP CHN SERVER} 
</code></pre>

<h2 id="updating-chn-server-to-log-to-cifv3">Updating CHN Server to log to CIFv3</h2>
<p>Like when starting CHN Server, simply run the following commands:</p>
<pre><code class="bash">cd /opt/chnserver &amp;&amp; python3 guided_docker_compose.py
</code></pre>

<p>Answer "n" when asked about reconfiguring CHN Server.</p>
<p>When you reach the question about enabling CIFv3, answer 'Y'.</p>
<p>Enter the provided information for the CIF host URL, including the "https" portion:</p>
<pre><code class="text">${CIF SERVER}
</code></pre>

<p>Enter the provided API Token.</p>
<p>Also be sure to update the CIF_PROVIDER field to "group-NUMBER", where <code>NUMBER</code> is the group number you were assigned.</p>
<pre><code class="text">Previous chn-server.sysconfig file detected. Do you wish to reconfigure? [Y/n]: n
Do you wish to enable logging to a remote CIFv3 server? [Y/n]: Y
Please enter the URL for the remote CIFv3 server: ${CIF SERVER}
Please enter the API token for the remote CIFv3 server: ${CIF TOKEN}
Please enter a name you wish to be associated with your organization: group-${GROUP}
Wrote file to config/sysconfig/hpfeeds-cif.sysconfig
Previous hpfeeds-logger.sysconfig file detected. Do you wish to reconfigure? [y/N]: n
</code></pre>

<h2 id="start-the-hpfeeds-cif-container">Start the hpfeeds-cif container</h2>
<p>Start hpfeeds-cif container with the following command:</p>
<pre><code class="bash">docker-compose up -d hpfeeds-cif
</code></pre>

<h2 id="test-your-cif-install">Test your CIF install</h2>
<p>Please generate another honeypot event to ensure there's data to find.</p>
<p>Open a new terminal tab/window, and export your team number again; for example if your team number is 50:</p>
<p>Now, attempt to connect to the honeypot SSH port:</p>
<p>On Mac/Linux:</p>
<pre><code class="bash">ssh -l ubuntu -p 2222 ${GROUP CHN SERVER}
</code></pre>

<p>On Windows:</p>
<pre><code class="bash">ssh -l ubuntu -p 2222 ${GROUP CHN SERVER}
</code></pre>

<p>Now examine the hpfeeds-cif logs to see if you see a new event:</p>
<pre><code class="bash">docker-compose logs --tail=10 hpfeeds-cif
</code></pre>

<h2 id="installing-cif-tools">Installing CIF Tools</h2>
<p>Seeing that data is submitted via logs is handy, but not very useful for using the data. We'll install the CIF SDK, 
which provides some command line tools for selecting, retrieving, and formatting data from a CIF server.</p>
<p>For this workshop, weâ€™ll install the CIFv3 tools onto the CHN Server system, but the SDK can be installed on any 
Linux system. </p>
<p>Begin by SSHing into the CHN Server host:</p>
<p>On Mac/Linux:</p>
<pre><code class="bash">ssh -l ubuntu -p 4222 ${GROUP CHN SERVER}
</code></pre>

<p>On Windows:</p>
<pre><code class="bash">ssh -l ubuntu -p 4222 ${GROUP CHN SERVER}
</code></pre>

<p>Once connected, install the CIFv3 pip package:</p>
<pre><code class="bash">sudo apt install python-pip -y &amp;&amp; sudo pip install 'cifsdk&gt;=3.0.0,&lt;4.0'
</code></pre>

<p>Next you need to create a new file, <code>/home/ubuntu/.cif.yml</code>, with the following contents. Remember to use either nano
 or vim to create this file:</p>
<p>Create the file:</p>
<pre><code class="bash">nano /home/ubuntu/.cif.yml
</code></pre>

<p>Then paste in these contents:</p>
<pre><code class="yaml">token: &lt;same value as CIF_TOKEN&gt;
remote: ${CIF SERVER URL}
no_verify_ssl: true
</code></pre>

<p>Now hit <code>Ctrl-X</code> to quit, answer <code>y</code> to save, and hit enter to keep your filename.</p>
<p>You can now verify that you can connect to the CIF instance with the SDK using the following command:</p>
<pre><code class="bash">cif -p
</code></pre>

<p>Which, when correctly configured and working properly, will return results like:</p>
<pre><code class="bash">roundtrip: 0.115531921387 ms
roundtrip: 0.0400021076202 ms
roundtrip: 0.0375020503998 ms
roundtrip: 0.0692510604858 ms
</code></pre>

<h2 id="querying-cif">Querying CIF</h2>
<p>Now you can search for the entry you generated earlier, looking for your provider name with the following command. Be
 sure to substitute your group number in the provider field. For instance, if you're group number was 2:</p>
<pre><code class="bash">cif --tags honeypot --itype ipv4 --last-hour --provider group-2
</code></pre>

<p>Trying again without the <code>--provider</code> option will show you any other submissions from your classmates!</p>
<pre><code class="bash">cif --tags honeypot --itype ipv4 --last-hour
</code></pre>

<h2 id="bonus">Bonus</h2>
<p>Check out the <a href="https://communityhoneynetwork.readthedocs.io/en/latest/hpfeeds-cif/#selecting-and-formatting-data">project documentation</a> 
for some more ideas on how you can use the CIF client to select and format data.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="../configuring_logging/" class="btn btn-neutral" title="Setting Up Logging for Honeypot Data"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../configuring_logging/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
